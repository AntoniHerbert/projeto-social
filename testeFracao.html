<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Frações Arrastável</title>
  <style>
    .fraction { display: inline-block; margin: 20px; text-align: center; }
    .slot { border: 1px solid black; width: 50px; height: 30px; display: flex; justify-content: center; align-items: center; margin: 2px; }
    .numerator, .denominator { width: 100%; display: flex; justify-content: center; }
    .draggable { cursor: pointer; padding: 5px; background-color: #ddd; border: 1px solid #888; margin: 2px; text-align: center; }
    .operator { font-weight: bold; padding: 5px; }
  </style>
</head>
<body>
  <h1>Calculadora de Frações</h1>

  <div id="fractions-container" style="display: flex;"></div>

  <button onclick="generateFractions()">Gerar Frações</button>
  <button onclick="resolveFractions()">Resolver</button>

  <script>
    function getRandomNumber() {
      return Math.floor(Math.random() * 10) + 1;
    }

    function getRandomOperator() {
      const operators = ["+", "-", "x", "÷"];
      return operators[Math.floor(Math.random() * operators.length)];
    }

    function createFraction(numerator, denominator) {
      const fractionDiv = document.createElement("div");
      fractionDiv.classList.add("fraction");

      const numDiv = createSlot(numerator);
      numDiv.classList.add("numerator");
      fractionDiv.appendChild(numDiv);

      const denDiv = createSlot(denominator);
      denDiv.classList.add("denominator");
      fractionDiv.appendChild(denDiv);

      return fractionDiv;
    }

    function createSlot(content) {
      const slotDiv = document.createElement("div");
      slotDiv.classList.add("slot");
      slotDiv.setAttribute("ondrop", "drop(event)");
      slotDiv.setAttribute("ondragover", "allowDrop(event)");

      if (content !== undefined) {
        const element = createDraggable(content);
        slotDiv.appendChild(element);
      }
      return slotDiv;
    }

    function createDraggable(content) {
      const draggableDiv = document.createElement("div");
      draggableDiv.classList.add("draggable");
      draggableDiv.textContent = content;
      draggableDiv.setAttribute("draggable", "true");
      draggableDiv.setAttribute("ondragstart", "drag(event)");
      return draggableDiv;
    }

    function generateFractions() {
      const container = document.getElementById("fractions-container");
      container.innerHTML = ""; // Limpa frações anteriores

      // Fração 1
      const numerator1 = getRandomNumber();
      const denominator1 = getRandomNumber();
      const fraction1 = createFraction(numerator1, denominator1);
      container.appendChild(fraction1);

      // Operador
      const operator = getRandomOperator();
      const operatorDiv = document.createElement("div");
      operatorDiv.classList.add("operator");
      operatorDiv.textContent = operator;
      container.appendChild(operatorDiv);

      // Fração 2
      const numerator2 = getRandomNumber();
      const denominator2 = getRandomNumber();
      const fraction2 = createFraction(numerator2, denominator2);
      container.appendChild(fraction2);
    }

    function resolveFractions() {
      const container = document.getElementById("fractions-container");
      const [fraction1, operatorDiv, fraction2] = container.children;
      const num1 = parseInt(fraction1.querySelector(".numerator .draggable").textContent);
      const den1 = parseInt(fraction1.querySelector(".denominator .draggable").textContent);
      const num2 = parseInt(fraction2.querySelector(".numerator .draggable").textContent);
      const den2 = parseInt(fraction2.querySelector(".denominator .draggable").textContent);
      const operator = operatorDiv.textContent;

      let resultNum, resultDen, intermediateNum, intermediateDen;

      if (operator === "x") {
        resultNum = num1 * num2;
        resultDen = den1 * den2;
      } else if (operator === "÷") {
        resultNum = num1 * den2;
        resultDen = den1 * num2;
      } else if (operator === "+" || operator === "-") {
        intermediateDen = den1 * den2;
        const n1 = num1 * den2;
        const n2 = num2 * den1;
        intermediateNum = `${n1} ${operator} ${n2}`;
        resultNum = operator === "+" ? n1 + n2 : n1 - n2;
        resultDen = intermediateDen;

        // Cria fração intermediária com numerador como `div` slot
        const intermediateFraction = document.createElement("div");
        intermediateFraction.classList.add("fraction");

        const intermediateNumDiv = document.createElement("div");
        intermediateNumDiv.classList.add("slot"); // `div` slot para o numerador
        intermediateNumDiv.setAttribute("ondrop", "drop(event)");
        intermediateNumDiv.setAttribute("ondragover", "allowDrop(event)");

        // Adiciona `divs` arrastáveis separadas para n1 e n2 no numerador da fração intermediária
        intermediateNumDiv.appendChild(createDraggable(n1));
        intermediateNumDiv.appendChild(createOperator(operator));
        intermediateNumDiv.appendChild(createDraggable(n2));

        intermediateFraction.appendChild(intermediateNumDiv);
        intermediateFraction.appendChild(createSlot(intermediateDen)); // Denominador intermediário

        container.appendChild(document.createTextNode("Fração Intermediária:"));
        container.appendChild(intermediateFraction);
      }

      // Cria fração final
      const resultFraction = createFraction(resultNum, resultDen);
      container.appendChild(document.createTextNode("Resultado Final:"));
      container.appendChild(resultFraction);
    }

    function createOperator(operator) {
      const operatorDiv = document.createElement("div");
      operatorDiv.classList.add("operator");
      operatorDiv.textContent = operator;
      return operatorDiv;
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function drag(event) {
      event.dataTransfer.setData("text", event.target.textContent);
    }

    function drop(event) {
      event.preventDefault();
      const data = event.dataTransfer.getData("text");
      event.target.innerHTML = ""; // Limpa o slot antes de adicionar o conteúdo arrastado
      const newElement = createDraggable(data);
      event.target.appendChild(newElement);
    }
  </script>
</body>
</html>
